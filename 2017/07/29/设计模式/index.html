<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/favicon.ico?v=5.1.4" color="#222">





  <meta name="keywords" content="设计模式," />










<meta name="description" content="设计模式提高了系统的可重用性和可扩展性，实现了代码的解耦。根据实际用途，设计模式可分为创建型(Creational)，结构型(Structural)和行为型(Behavioral)三种，其中创建型模式主要用于描述如何创建对象，结构型模式主要用于描述如何实现类或对象的组合，行为型模式主要用于描述类或对象怎样交互以及怎样分配职责，在GoF 23种设计模式中包含5种创建型设计模式、7种结构型设计模式和1">
<meta name="keywords" content="设计模式">
<meta property="og:type" content="article">
<meta property="og:title" content="设计模式">
<meta property="og:url" content="http://yoursite.com/2017/07/29/设计模式/index.html">
<meta property="og:site_name" content="Gordong">
<meta property="og:description" content="设计模式提高了系统的可重用性和可扩展性，实现了代码的解耦。根据实际用途，设计模式可分为创建型(Creational)，结构型(Structural)和行为型(Behavioral)三种，其中创建型模式主要用于描述如何创建对象，结构型模式主要用于描述如何实现类或对象的组合，行为型模式主要用于描述类或对象怎样交互以及怎样分配职责，在GoF 23种设计模式中包含5种创建型设计模式、7种结构型设计模式和1">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-03-10T11:45:39.520Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="设计模式">
<meta name="twitter:description" content="设计模式提高了系统的可重用性和可扩展性，实现了代码的解耦。根据实际用途，设计模式可分为创建型(Creational)，结构型(Structural)和行为型(Behavioral)三种，其中创建型模式主要用于描述如何创建对象，结构型模式主要用于描述如何实现类或对象的组合，行为型模式主要用于描述类或对象怎样交互以及怎样分配职责，在GoF 23种设计模式中包含5种创建型设计模式、7种结构型设计模式和1">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/07/29/设计模式/"/>





  <title>设计模式 | Gordong</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?95ac7d2cf2ac052e787d934c29dac40e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Gordong</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">GuoDongDong's Personal Blog</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/29/设计模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="郭冬冬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Gordong">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">设计模式</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-29T17:57:14+08:00">
                2017-07-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/07/29/设计模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/07/29/设计模式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/07/29/设计模式/" class="leancloud_visitors" data-flag-title="设计模式">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o">本文总阅读量</i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>设计模式提高了系统的可重用性和可扩展性，实现了代码的解耦。根据实际用途，设计模式可分为创建型(Creational)，结构型(Structural)和行为型(Behavioral)三种，其中创建型模式主要用于描述如何创建对象，结构型模式主要用于描述如何实现类或对象的组合，行为型模式主要用于描述类或对象怎样交互以及怎样分配职责，在GoF 23种设计模式中包含5种创建型设计模式、7种结构型设计模式和11种行为型设计模式。<br><a id="more"></a></p>
<h1 id="面向对象设计原则"><a href="#面向对象设计原则" class="headerlink" title="面向对象设计原则"></a>面向对象设计原则</h1><ol>
<li>单一职责原则    (Single    Responsibility Principle,    SRP)：一个类只负责一个功能领域中的相应职责，它是实现高内聚、低耦合的指导方针。</li>
<li>开闭原则 (Open-Closed Principle, OCP)：软件实体应对扩展开放，而对修改关闭，即软件实体应尽量在不修改原有代码的情况下进行扩展。</li>
<li>里氏代换原则 (Liskov Substitution Principle, LSP)：所有引用基类对象的地方能够透明地使用其子类的对象，在软件中将一个基类对象替换成它的子类对象，程序将不会产生任 何错误和异常，反过来则不成立。</li>
<li>依赖倒转原则 (Dependence Inversion Principle, DIP)：抽象不应该依赖于细节，细节应该依赖于抽象，在程序代码中传递参数时或在关联关系中，尽量引用层次高的抽象层 类，即使用接口和抽象类进行变量类型声明、参数类型声明、方法返回类型声明，以及数据 类型的转换等，而不要用具体类来做这些事情。依赖注入(DependencyInjection,    DI)就是一个很好的例子。</li>
<li>接口隔离原则 (Interface Segregation Principle, ISP)：使用多个专门的接口，而不使用单一的总接口</li>
<li>合成复用原则 (Composite Reuse Principle, CRP)：尽量使用对象组合，而不是继承来达到复用的目的</li>
<li>迪米特法则 (Law of Demeter, LoD)：一个软件实体应当尽可能少地与其他实体发生相互作用</li>
</ol>
<h1 id="1-单例模式-Singleton-Pattern"><a href="#1-单例模式-Singleton-Pattern" class="headerlink" title="1 单例模式 Singleton Pattern *"></a>1 单例模式 Singleton Pattern *</h1><p>确保某一个类只有一个实 例，而且自行实例化并向整个系统提供这个实例，这个类称为单例类。像我们熟悉的Windows任务管理器就是一个单例模式，确保Windows任务管理器在系统中有且仅有一个非常重要。<br>为了防止在外部对其实例化，将其构造函数设计为私有；在单例类内部定义了一个Singleton类型的私有静态对象，作为外部共享的唯一实例；同时它提供一个静态的getInstance()工厂方法，让客户可以访问它的唯一实例。如果类对象的创建需要很长时间，在多线程并发时就会出现创建多个对象的情况，解决方案其中一种是 <strong>饿汉式单例类</strong>，在类被加载时就将自己实例化；另一种是 <strong>懒汉式单例</strong>，在第一次调用getInstance()方法时实例化，在类加载时并不自行实例化，这种技术又称为延迟加载(Lazy    Load)技术，即需要的时候再加载实例，为了避免多个线程同时调用getInstance()方法，且保证性能，可以使用 <strong>双重检查锁定(Double-Check Locking)</strong>，使用关键字synchronized对其中的代码“instance    =    new    LazySingleton();”进行线程锁定判断， 同时在synchronized中再进行一次(instance    ==    null)判断。<br>饿汉式单例类优点在于无须考虑多线程访问问题，缺点由于单例对象一开始就得以创建，资源利用效低；懒汉式单例类在第一次使用时创建，无须一直占用系统资源，实现了延迟加载，但是必须处理好多个线程同时访问的问题，这将导致系统性能受到一定影响。一种更好的单例实现方法是被称之为Initialization    Demand Holder (IoDH)的技术，在IoDH中，我们在单例类中增加一个静态(static)内部类，在该内部类中创建单例对象，再将 该单例对象通过getInstance()方法返回给外部使用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//Initialization	on	Demand	Holder</span><br><span class="line">class Singleton &#123;</span><br><span class="line">    private Singleton() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static class HolderClass &#123;</span><br><span class="line">        private final static Singleton instance = new Singleton();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static Singleton getInstance() &#123;</span><br><span class="line">        return HolderClass.instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>由于静态单 例对象没有作为Singleton的成员变量直接实例化，因此类加载时不会实例化Singleton，第一次 调用getInstance()时将加载内部类HolderClass，在该内部类中定义了一个static类型的变量 instance，此时会首先初始化这个成员变量，由Java虚拟机来保证其线程安全性，确保该成员 变量只能初始化一次。由于getInstance()方法没有任何线程锁定，因此其性能不会造成任何影响。<br>通过使用IoDH，我们既可以实现延迟加载，又可以保证线程安全，不影响系统性能，不失为 一种最好的Java语言单例模式实现方式（其缺点是与编程语言本身的特性相关，很多面向对象 语言不支持IoDH）。</p>
<p>实际应用中的，负载均衡服务器、注册表、线程池等的设计和实现都是必须要保证单一性，使用了单例模式。</p>
<h1 id="1-简单工厂模式-Simple-Factory-Pattern"><a href="#1-简单工厂模式-Simple-Factory-Pattern" class="headerlink" title="1 简单工厂模式 Simple Factory Pattern *"></a>1 简单工厂模式 Simple Factory Pattern *</h1><p>定义一个工厂类，它可以根据参数的不同返回不同类的实例，被创建的实例通常都具有共同的父类。因为在简单工厂模式中用于创建实例的方法是静态(static)方法，因此简单工厂模式又被称为静态工厂方法(Static Factory Method)模式。</p>
<h1 id="1-工厂方法模式-Factory-Method-Pattern-1"><a href="#1-工厂方法模式-Factory-Method-Pattern-1" class="headerlink" title="1 工厂方法模式 Factory Method Pattern 1*"></a>1 工厂方法模式 Factory Method Pattern 1*</h1><p>定义一个用于创建对象的接口，让子类决定将哪一个类实例化。工厂方法模式让一个类的实例化延迟到其子类。与简单工厂模式相比，工厂方法模式最重要的区别是引入了抽象工厂角色。<br>工厂方法模式是使用频率最高的设计模式之一，是很多开源框架和API类库的 核心模式。</p>
<h1 id="1-抽象工厂模式-Abstract-Factory-Pattern"><a href="#1-抽象工厂模式-Abstract-Factory-Pattern" class="headerlink" title="1 抽象工厂模式 Abstract Factory Pattern"></a>1 抽象工厂模式 Abstract Factory Pattern</h1><p>与工厂方法模式相比，抽象工厂模式中 的具体工厂不只是创建一种产品，它负责创建一族产品。<br>例如如果需要增加新的皮肤，只需增加一族新的具体组件并对应提供一个新的具体工厂，修改配置文件即可使用新的皮肤，原有代码无须修改，符合“开闭原则”。在Java语言的AWT（抽象窗口工具包）中就使用了抽象工厂模式，它使用抽象工厂模式来实现在不同的操作系统中应用程序呈现与所在操作系统一致的外观界面。</p>
<h1 id="1-原型模式-Prototype-Pattern"><a href="#1-原型模式-Prototype-Pattern" class="headerlink" title="1 原型模式 Prototype Pattern"></a>1 原型模式 Prototype Pattern</h1><p>首先创建一个原型对象，再通过复制这个原型对象来创建更多同类型的对象。原理是将一个原型对象传给那个要发动创建的对象，这个要发动创建的对象通过请求原型对象拷贝自己来实现创建过程。通过克隆方法所创建的对象是全新的对象，它们在内存中拥有新的地址，通常对克隆所产生的对象进行修改对原型对象不会造成任何影响，每一个克隆对象都是相互独立的。<br>通用的克隆实现方法是在具体原型类的克隆方法中实例化一个与自身类型相同的对象并将其返回，并将相关的参数传入新创建的对象中，保证它们的成员属性相同。或者在Java中可以直接使用Object提供的clone()方法来实现对象的克隆，实现克隆的Java类必须实现一个标识接口Cloneable，表示这个Java类支持被复制。<br>有两种不同的克隆方式：<strong>浅克隆(引用值复制)和深克隆(新对象完全复制)</strong>。在Java语言中，通过覆盖Object类的clone()方法可以实现浅克隆，只复制原型对象的所有引用对象地址；在深克隆中，无论原型对象的成员变量是值类型还是引用类型，都将复制一份给克隆对象，如果需要实现深克隆，可以通过序列化(Serialization)等方式来实现。序列化就是将对象写到流的过程，写到流中的对象是原有对象的一个拷贝，而原对象仍然存在于内存中。</p>
<h1 id="1-建造者模式-Builder-Pattern"><a href="#1-建造者模式-Builder-Pattern" class="headerlink" title="1 建造者模式 Builder Pattern"></a>1 建造者模式 Builder Pattern</h1><p>建造者模式一般用于构建游戏角色模型、汽车模型等。<br>定义：它将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。<br>描述：在建造者模式中，首先由 <strong>产品(Product)类</strong>，它一般是bean，产品的零件是它的成员变量；其次是 <strong>建造者(Builder)</strong>，它直接负责为每个零件进行赋值处理，完成产品对象；最后一个重要的是 <strong>指挥者(Director)</strong>，它用于指导具体建造者如何构建产品，它按一定次序调用Builder的buildPartX()方法，控制调用的先后次序，并向客户端返回一个完整的产品对象。<br>在一些框架常见到一种闭包回调方法，增加一类称之为 <strong>钩子方法(HookMethod)</strong> 的特殊方法来控制是否对某个buildPartX()的调用，钩子方法的返回类型通常为boolean类型，方法名一般为isXXX()，钩子方法定义在抽象建造者类中。例如构建游戏角色时，某个角色无须构建头发部件，则对应的具体建造器将覆盖isBareheaded()方法，并将返回值改为true(接口类默认返回false，因为所有角色默认会构建头发)。这样本来是指挥者Director控制建造者Builder构建整个过程次序，但是现在建造者可以通过钩子方法来控制产品零件是否建造。</p>
<h1 id="2-适配器模式-Adapter-Pattern-不兼容结构的协调"><a href="#2-适配器模式-Adapter-Pattern-不兼容结构的协调" class="headerlink" title="2 适配器模式 Adapter Pattern * -    不兼容结构的协调"></a>2 适配器模式 Adapter Pattern * -    不兼容结构的协调</h1><p>生活中，笔记本电压是20V，而家庭用电是220V，为了让20V的笔记本电脑能够在220V的电压下工作，就需要引入一个电源适配器(AC Adapter)，俗称充电器或变压器。与电源适配器相似，在适配器模式中引入了一个被称为适配器(Adapter)的包装类，而它所包装的对象称为适配者(Adaptee)，即被适配的类。适配器的实现就是把客户类的请求转化为对适配者的相应接口的调用。也就是说：当客户类调用适配器的方法时，在适配器类的内部将调用适配者类的方法，而这个过程对客户类是透明的，客户类并不直接访问适配者类。因此，适配器让那些由于接口不兼容而不能交互的类可以一起工作。<br>定义：将一个接口转换成客户希望的另一个接口，使接口不兼容的那些类可以一起工作，其别名为包装器(Wrapper)。包含Target(目标抽象类)、Adapter(适配器类)、Adaptee(适配者类，即被适配的角色)三个角色。</p>
<p>一、对象适配器模式。适配器类与适配者类是关联关系（也可称之为委派关系）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class	Adapter	extends	Target	&#123;</span><br><span class="line">		private	Adaptee	adaptee;	//维持一个对适配者对象的引用		</span><br><span class="line">		public	Adapter(Adaptee	adaptee)	&#123;</span><br><span class="line">      	this.adaptee=adaptee;						</span><br><span class="line">    &#125;		</span><br><span class="line"></span><br><span class="line">		public	void	request()	&#123;</span><br><span class="line">      	adaptee.specificRequest();	//转发调用						</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>二、类适配器，适配器和适配者是继承关系。<br>三、缺省适配器。当不需要实现一个接口所提供的所有方法时，可先 设计一个抽象类实现该接口，并为接口中每个方法提供一个默认实现（空方法），那么该抽 象类的子类可以选择性地覆盖父类的某些方法来实现需求，它适用于不想使用一个接口中的 所有方法的情况，又称为单接口适配器模式。</p>
<h1 id="2-桥接模式-Bridge-Pattern"><a href="#2-桥接模式-Bridge-Pattern" class="headerlink" title="2 桥接模式 Bridge Pattern"></a>2 桥接模式 Bridge Pattern</h1><p>如果软件系统中某个类存在两个独立变化的维度，通过该模式可以将这两个维度分离出来，使两者可以独立扩展。与多层继承方案不同，它将两个独立变化的维度设计为两个独立的继承等级结构，并且在抽象层建立一个抽象关联，该关联关系类似一条连接两个独立继承结构的桥，故名桥接模式。桥接模式用一种巧妙的方式处理多层继承存在的问题，用抽象关联取代了传统的多层继承，将类之间的静态继承关系转换为动态的对象组合关系。<br>通常情况下，我们将具有两个独立变化维度的类的一些普通业务方法和与之关系最密切的维度设计为“抽象类”层次结构（抽象部分），而将另一个维度设计为“实现类”层次结构（实现部分）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">interface	Implementor	&#123;</span><br><span class="line">  	public	void	operationImpl();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">abstract	class	Abstraction	&#123;</span><br><span class="line">  	protected	Implementor	impl;	//定义实现类接口对象		</span><br><span class="line">		public	void	setImpl(Implementor	impl)	&#123;										</span><br><span class="line">      this.impl=impl;						</span><br><span class="line">    &#125;		</span><br><span class="line">		public	abstract	void	operation();		//声明抽象业务方法		</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class	RefinedAbstraction	extends	Abstraction	&#123;						</span><br><span class="line">    public	void	operation()	&#123;										</span><br><span class="line">       //业务代码										</span><br><span class="line">       impl.operationImpl();		//调用实现类的方法										</span><br><span class="line">    &#125;		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="2-组合模式-Composite-Pattern"><a href="#2-组合模式-Composite-Pattern" class="headerlink" title="2 组合模式 Composite Pattern *"></a>2 组合模式 Composite Pattern *</h1><p>组合模式一般用来处理树形结构，例如操作系统中的目录结构、应用软件中的菜单、办公系统中 的公司组织结构等等。<br>比如一个杀毒(AntiVirus)软件，该软件既可以对某个文件夹(Folder)杀毒，也可以对某个指定的文件(File)进行杀毒。该杀毒软件还可以根据各类文件的特点，为不同类型的文件提供不同的杀毒方式，例如图像文件(ImageFile)和文本文件(TextFile)的杀毒方式就有所差异。对于树形结构，当容器对象（如文件夹）的某一个方法被调用时，将遍历整个树形结构，寻 找也包含这个方法的成员对象（可以是容器对象，也可以是叶子对象）并调用执行，牵一而动百，其中使用了递归调用的机制来对整个结构进行处理。<br>定义：组合多个对象形成树形结构以表示具有“整体—部分”关系的层次结构。组合模式对单个对象（即叶子对象）和组合对象（即容器对象）的使用具有一致性，组合模式又可以称为“整体—部分”(Part-Whole)模式。<br>在组合模式中引入了抽象构件类Component，它是所有容器类Composite和叶子类Leaf的公共父类。<br>组合模式分为 <strong>透明组合模式</strong> 和 <strong>安全组合模式</strong> 两种形式。透明组合模式：抽象构件Component中声明了所有用于管理成员对象的方法，优点是可确保所有的构件类都有相同的接口，缺点是不够安全，因为叶子对象和容器对象在本质上是有区别的。叶子对象 不可能有下一个层次的对象，即不可能包含成员对象，因此为其提供add()、remove()以及 getChild()等方法是没有意义的，这在编译阶段不会出错，但在运行阶段如果调用这些方法可 能会出错（如果没有提供相应的错误处理代码）；安全组合模式：在抽象构件Component中没有声明任何用于管理成员对象的方法，而是在 Composite类中声明并实现这些方法。这种做法是安全的，因为根本不向叶子对象提供这些管 理成员对象的方法，对于叶子对象，客户端不可能调用到这些方法，的缺点是不够透明，因为叶子构件和容器构件具有不同的方法，且容器构件中 那些用于管理成员对象的方法没有在抽象构件类中定义，因此客户端不能完全针对抽象编 程，必须有区别地对待叶子构件和容器构件。<br>在实际应用中，安全组合模式的使用频率非常高，在Java    AWT中使用的组合模式就是安全组合模式。</p>
<h1 id="2-装饰模式-Decorator-Pattern"><a href="#2-装饰模式-Decorator-Pattern" class="headerlink" title="2 装饰模式 Decorator Pattern"></a>2 装饰模式 Decorator Pattern</h1><p>装饰模式可以在不改变一个对象本身功能的基础上给对象增加额外的新行为，是一种用于替代继承的技术，它通过一种无须定义子类的方式来给对象动态增加职责，使用对象之间的关联关系取代类之间的继承关系。例如一间毛坯房装修完本质是一间房子。<br>定义：动态地给一个对象增加一些额外的职责，就增加对象功能来说，装饰模式比生成子类实现更为灵活。Component（抽象构件）是ConcreteComponent（具体构件）和Decorator（抽象装饰类）的共同父类，这样客户端并不会觉得对象在装饰前和装饰后有 什么不同。具体实现上，在抽象装饰类维持对抽象构件类型对象的引用，在继承关系上增加组合关系。<br>一般装饰模式是 <strong>透明装饰模式</strong> ，透明性要求客户端程序不应该将对象声明为具体构件类型或具体装饰类型，而应该全部声明为抽象构件类型。有时需要单独调用具体装饰类新增的业务方法，就需要用到 <strong>半透明装饰模式</strong>，就不得不用具体装饰类型来定义装饰之后的对象，而具体构件类型还是可以 使用抽象构件类型来定义。</p>
<h1 id="2-外观模式-Facade-Pattern"><a href="#2-外观模式-Facade-Pattern" class="headerlink" title="2 外观模式 Façade Pattern *"></a>2 外观模式 Façade Pattern *</h1><p>自己泡茶需要和茶具、茶叶直接打交道，如果去茶馆喝茶，只需和服务员打交道，服务员操作茶叶、茶具泡好茶递给客户。<br>外观模式通过引入一个新的外观类(Facade)来实现该功能，外观类充当了软件系统中的“服务员”，它为多个业务类的调用提供了一个统一的入口，简化了类与类之间的交互。。在外观模式中，那些需要交互的业务类被称为子系统(Subsystem)。如果没有外观类，那么每个客户类需要和多个子系统之间进行复杂的交互，系统的耦合度将很大。<br>定义：为子系统中的一组接口提供一个统一的入口，外观模式定义了一个高层接口，这个接口使得这一子系统更加容易使用。    外观模式包含Facade（外观角色）和    SubSystem（子系统角色），简单来说，就是外观角色把子系统角色组合封装进自己的对象中。</p>
<h1 id="2-享元模式-Flyweight-Pattern"><a href="#2-享元模式-Flyweight-Pattern" class="headerlink" title="2 享元模式 Flyweight Pattern"></a>2 享元模式 Flyweight Pattern</h1><p>围棋棋盘中包含大量的黑子和白子，它们的形状、大小都一模一样，只是出现的位置不同而已，如果将每一个棋子都作为一个独立的对象存储在内存中，将导致该围棋软件在运行时所需内存空间较大。<br>享元模式通过共享技术实现相同或相似对象的重用，在逻辑上每一个出现的字符都有一个对象与之对应，然而在物理上它们却共享同一个享元对象，这个对象可以出现在一个字符串的不同地方，相同的字符对象都指向同一个实例，在享元模式中，存储这些共享实例对象的地方称为 <strong>享元池(Flyweight    Pool)</strong>。我们可以针对每一个不同的字符创建一个享元对象，将其放在享元池中，需要时再从享元池取出。享元对象能做到共享的关键是区分了 <strong>内部状态(Intrinsic    State)和外部状态(Extrinsic    State)</strong>，<br>可以将具有相同内部状态的对象存储在享元池中，通过向取出的对象注入不同的外部状态，可以得到一系列相似的对象。<br>享元模式一般结合工厂模式一起使用，享元工厂类用于创建并管理享元对象，将各种类型的具体享元对象存储在一个享元池中，享元池一般设计为一个存储“键值对”的集合（也可以是其他类型的集合），当用户需要对象时，首先从享元池中获取，如果享元池中不存在，则创建一个新的享元对象返回给用户，并在享元池中保存该新增对象。为了使享元池保持唯一性，享元工厂类一般使用单例模式进行设计。<br>标准的享元模式结构图中既包含可以共享的具体享元类，也包含不可以共享的非共享具体享元类。但是在实际使用过程中，我们有时候会用到两种特殊的享元模式：<strong>单纯享元模式和复合享元模式</strong>。在单纯享元模式中，所有的具体享元类都是可以共享的，不存在非共享具体享元类。复合享元模式是，将一些单纯享元对象使用组合模式加以组合，还可以形成复合享元对象，这样的复合享元对 象本身不能共享，但是它们可以分解成单纯享元对象，而后者则可以共享。<br><strong>JDK类库中的String类使用了享元模式</strong>，Java    String类这种在修改享元对象时，先将原有对象复制一份，然后在新对象上再实施修改操作的机制称为“Copy    On    Write”。</p>
<h1 id="2-代理模式-Proxy-Pattern"><a href="#2-代理模式-Proxy-Pattern" class="headerlink" title="2 代理模式 Proxy Pattern *"></a>2 代理模式 Proxy Pattern *</h1><p>生活中常见的代购，而VPN软件中的如保护代理、远程代理、虚拟代理、缓冲代理等都是就是代理模式。<br>定义：给某一个对象提供一个代理或占位符，并由代理对象来控制对原对象的访问，代理对象在客户端对象和目标对象之间起到中介的作用，它去掉客户不能看到的内容和服务或者增添客户需要的额外的新服务。为了让客户端能够一致性地对待真实对象和代理对象，Proxy（代理主题角色）和RealSubject（真实主题角色）就必须实现Subject（抽象主题角色）一个共同接口。<br>代理类也是抽象主题类的子类，它维持一个对真实主题对象的引用，调用在真实主题中实现的业务方法，在调用时可以在原有业务方法的基础上附加一些新的方法来对功能进行扩充或约束。</p>
<ol>
<li>远程代理(Remote    Proxy)：为一个位于不同的地址空间的对象提供一个本地的代理对象，这个不同的地址空间可以是在同一台主机中，也可是在另一台主机中，远程代理又称为大使 (Ambassador)。如常见的RPC机制。</li>
<li>虚拟代理(Virtual    Proxy)：如果需要创建一个资源消耗较大的对象，先创建一个消耗相对较小的对象来表示，真实对象只在需要时才会被真正创建。如操作系统的 Deamon 守护进程和应用程序快捷方式。</li>
<li>保护代理(Protect    Proxy)：控制对一个对象的访问，可以给不同的用户提供不同级别的使用权限。</li>
<li>缓冲代理(Cache    Proxy)：为某一个目标操作的结果提供临时的存储空间，以便多个客户端 可以共享这些结果。</li>
<li>智能引用代理(Smart    Reference    Proxy)：当一个对象被引用时，提供一些额外的操作，例如 将对象被调用的次数记录下来等。</li>
</ol>
<h1 id="3-职责链模式-Chain-of-Responsibility-Pattern"><a href="#3-职责链模式-Chain-of-Responsibility-Pattern" class="headerlink" title="3 职责链模式 Chain of Responsibility Pattern"></a>3 职责链模式 Chain of Responsibility Pattern</h1><p>例如在Web应用开发中创 建一个过滤器(Filter)链来对请求数据进行过滤，在工作流系统中实现公文的分级审批等等，<br>职责链模式可以将请求的处理者组织成一条链，并让请求沿着链传递，由链上的处理者对请求进行相应的处理，客户端无须关心请求的处理细节以及请求的传递，只需将请求发送到链上即可。很多对象由每一个对象对其下家的引用而连接起来形成一条链。请求在这个链上传递，直到链上的某一个对象决定处理此请求，发出这个请求的客户端并不知道链上的哪一个对象最终处理这个请求。<br>职责链模式可分为纯的职责链模式和不纯的职责链模式两种。纯的职责链模式：要求一个具体处理者对象只能在两个行为中选择一个：要么承担全部责任，要么将责任推给下家；不纯的职责链模式：允许某个请求被一个具体处理者部分处理后再向下传递，或者一个具体处理者处理完某请求后其后继处理者可以继续处理该请求，而且一个请求可以最终不被任何处理者对象所接收。</p>
<h1 id="3-命令模式-Command-Pattern"><a href="#3-命令模式-Command-Pattern" class="headerlink" title="3 命令模式 Command Pattern *"></a>3 命令模式 Command Pattern *</h1><p>开关与具体电器如电灯、排气扇并无直接关系，开关和电灯之间并不存在直接耦合关系，它们通过电线连接在一起，使用不同的电线可以连接不同的请求接收者，只需更换一根电线，相同的发送者（开关）即可对应不同的接收者（电器）。<br>一个常见的软件开发例子是 <strong>自定义快捷键</strong>。命令模式可以将请求发送者和接收者完全解耦，将一个请求封装为一个对象，从而让我们可用不同的请求对客户进行参数化；对请求排队或者记录请求日志，以及支持可撤销的操作。<br>Invoker（调用者）调用Call具体Command（命令对象）的execute()方法，Command再调用Receiver（接收者）的相关操作Action()方法，程序执行过程中向发送者注入命令对象。还可以实现一个CommandQueu命令队列，一个请求产生多个命令执行。<br>宏命令(Macro    Command)又称为组合命令，它是组合模式和命令模式联用的产物。宏命令是一个具体命令类，它拥有一个集合属性，在该集合中包含了对其他命令对象的引用。通常宏命令不直接与请求接收者交互，而是通过它的成员来调用接收者的方法。当调用宏命令的execute()方法时，将递归调用它所包含的每个成员命令的execute()方法，一个宏命令的成员可以是简单命令，还可以继续是宏命令。执行一个宏命令将触发多个具体命令的执行，从而实现对命令的批处理。</p>
<h1 id="3-解释器模式-Interpreter-Pattern-自定义语言的实现"><a href="#3-解释器模式-Interpreter-Pattern-自定义语言的实现" class="headerlink" title="3 解释器模式 Interpreter Pattern - 自定义语言的实现"></a>3 解释器模式 Interpreter Pattern - 自定义语言的实现</h1><p>在解释器模式结构图中包含TerminalExpression（终结符表达式）、NonterminalExpression（非终结符表达式）、Context（环境类）几个角色。环境类Context用于存储解释器之外的一些全局信息，它通常作为参数被传 递到所有表达式的解释方法interpret()中，可以在Context对象中存储和访问表达式解释器的状 态，向表达式解释器提供一些全局的、公共的数据，此外还可以在Context中增加一些所有表 达式解释器都共有的功能，减轻解释器的职责。</p>
<h1 id="3-迭代器模式-Iterator-Pattern-遍历聚合对象中的元素"><a href="#3-迭代器模式-Iterator-Pattern-遍历聚合对象中的元素" class="headerlink" title="3 迭代器模式 Iterator Pattern* - 遍历聚合对象中的元素"></a>3 迭代器模式 Iterator Pattern* - 遍历聚合对象中的元素</h1><p>定义：提供一种方法来访问聚合对象，而不用暴露这个对象的内部表示，其别名为游标(Cursor)。    在迭代器模式结构图中包含角色：Iterator（抽象迭代器）：它定义了访问和遍历元素的接口，声明了用于遍历数据元素的方法；Aggregate（抽象聚合类）：它用于存储和管理元素对象，声明一个createIterator()方法用于创建一个迭代器对象，充当抽象迭代器工厂角色。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">class ConcreteIterator implements Iterator &#123;</span><br><span class="line">    private ConcreteAggregate objects;    //维持一个对具体聚合对象的引用，以便于访问存储在聚合对象中的数据				</span><br><span class="line">    private int cursor;    //定义一个游标，用于记录当前访问位置				</span><br><span class="line"></span><br><span class="line">    public ConcreteIterator(ConcreteAggregate objects) &#123;</span><br><span class="line">        this.objects = objects;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void first() &#123;......&#125;</span><br><span class="line"></span><br><span class="line">    public void next() &#123;......&#125;</span><br><span class="line"></span><br><span class="line">    public boolean hasNext() &#123;......&#125;</span><br><span class="line"></span><br><span class="line">    public Object currentItem() &#123;......&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteAggregate implements Aggregate &#123;</span><br><span class="line">    ...</span><br><span class="line">    public Iterator createIterator() &#123;</span><br><span class="line">        return new ConcreteIterator(this);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>除了使用关联关系外，为了能够让迭代器可以访问到聚合对象中的数据，我们还可以将迭代器类设计为聚合类的内部类，JDK中的迭代器类就是通过这种方法来实现的。</p>
<h1 id="3-中介者模式-Mediator-Pattern-协调多个对象之间的交互"><a href="#3-中介者模式-Mediator-Pattern-协调多个对象之间的交互" class="headerlink" title="3 中介者模式 Mediator Pattern - 协调多个对象之间的交互"></a>3 中介者模式 Mediator Pattern - 协调多个对象之间的交互</h1><p>如果在一个系统中对象之间存在多对多的相互关系，我们可以将对象之间的一些交互行为从各个对象中分离出来，并集中封装在一个中介者对象中，并由该中介者进行统一协调，这样对象之间多对多的复杂关系就转化为相对简单的一对多关系。<br>定义：用一个中介对象（中介者）来封装一系列的对象交互，中介者使各对象不需要显式地相互引用，从而使其耦合松散，而且可以独立地改变它们之间的交互。中介者模式又称为调停者模式。<br>中介者类需要保存对存储同事对象的引用，并使用operation()方法封装同事之间的调用，而在同事类中除了实现自己的行为外，并且维持一个抽象中介者的引用，定义依赖方法，调用mediator.operation()与中介者进行通信。</p>
<h1 id="3-备忘录模式-Memento-Pattern-撤销功能的实现"><a href="#3-备忘录模式-Memento-Pattern-撤销功能的实现" class="headerlink" title="3 备忘录模式 Memento Pattern - 撤销功能的实现"></a>3 备忘录模式 Memento Pattern - 撤销功能的实现</h1><p>可悔棋的中国象棋，“悔棋”就是让系统 恢复到某个历史状态，在很多软件中通常称之为“撤销”。备忘录模式提供了一种状态恢复的实现机制，使得用户可以方便地回到一个特定的历史步骤，当新的状态无效或者存在问题时，可以使用暂时存储起来的备忘录将状态复原。<br>定义：在不破坏封装的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态，这样可以在以后将对象恢复到原先保存的状态。<br>在备忘录模式结构图中包含如下几个角色：Originator（原发器）：需要保存内部状态的类；Memento（备忘录)：存储原发器的内部状态，根据原发器来决定保存哪些内部状态；Caretaker（负责人）：又称为管理者，它负责保存备忘录，但是不能对备忘录的内容 进行操作或检查。<br>对于备忘录类Memento而言，它通常提供了与原发器相对应的属性（可以是全部，也可以是部分）用于存储原发器的状态。原发器中提供一个方法把值传给备忘录对象并创建它。</p>
<h1 id="3-观察者模式-Observer-Pattern-对象间的联动"><a href="#3-观察者模式-Observer-Pattern-对象间的联动" class="headerlink" title="3 观察者模式 Observer Pattern * - 对象间的联动"></a>3 观察者模式 Observer Pattern * - 对象间的联动</h1><p>在观察者模式中定义了对象之间的一种一对多依赖关系，发生改变的对象称为观察目标，而被通知的对象称为观察者，使得每当一个对象状态发生改变时，其相关依赖对象皆得到通知并被自动更新。观察者模式的别名包括发布-订阅（Publish/Subscribe）模式、模型-视图（Model/View）模式、源-监听器 （Source/Listener）模式或从属者（Dependents）模式。<br>它包含    Subject（主题）：它是指被观察的对象；Observer（观察者）：观察者将对观察目标的改变做出反应。在Subject主题类中定义一个观察者集合用于存储所有观察者对象，它自己发生更新时发出通知notify()，遍历观察者集合调用每一个观察者的update()响应方法。<br>观察者模式在Java语言中的地位非常重要。在JDK的java.util包中，提供了Observable类以及 Observer接口，它们构成了JDK对观察者模式的支持。JDK    1.1及以后的各个版本中，事件处理模型采用基于观察者模式的委派事件模型 (DelegationEvent    Model,    DEM)，即一个Java组件所引发的事件并不由引发事件的对象自己来负责处理，而是委派给独立的事件处理对象负责。<br>在DEM模型中，目标角色（如界面组件）负责发布事件，而观察者角色（事件处理者）可以 向目标订阅它所感兴趣的事件。当一个具体目标产生一个事件时，它将通知所有订阅者。事 件的发布者称为事件源(Event    Source)，而订阅者称为事件监听器(Event    Listener)，在这个过程 中还可以通过事件对象(Event    Object)来传递与事件相关的信息，可以在事件监听者的实现类中 实现事件处理，因此事件监听对象又可以称为事件处理对象。事件源对象、事件监听对象 （事件处理对象）和事件对象构成了Java事件处理模型的三要素。事件源对象充当观察目标， 而事件监听对象充当观察者。<br>在当前流行的MVC(Model-View-Controller)架构中也应用了观察者模式，其中模型可对应于观察者模式中的观察目标，而视图对应于观察者，控制器可充当两者之间的中介者。当模型层的 数据发生改变时，视图层将自动改变其显示内容。</p>
<h1 id="3-状态模式-State-Pattern"><a href="#3-状态模式-State-Pattern" class="headerlink" title="3 状态模式 State Pattern"></a>3 状态模式 State Pattern</h1><p>生活中，银行账户状态因为存取款导致的余额发生变化而发生变化。<br>定义：状态模式用于解决系统中复杂对象的状态转换以及不同状态下行为的封装问题，允许一个对象在其内部状态改变时改变它的行为。<br>其中Context（环境类）维持一个对State（状态类）的引用，调用stateCheck()方法来检查状态是否需要发生变化；状态类维持对环境类的引用，使用环境类的变量作为状态变化的判断依据。<br>共享状态：在有些情况下，多个环境对象可能需要共享同一个状态，如果希望在系统中实现多个环境对 象共享一个或多个状态对象，那么需要将这些状态对象定义为环境类的静态成员对象。</p>
<h1 id="3-策略模式-Strategy-Pattern"><a href="#3-策略模式-Strategy-Pattern" class="headerlink" title="3 策略模式 Strategy Pattern"></a>3 策略模式 Strategy Pattern</h1><p>在策略模式中，我们可以定义一些独立的类来封装不同的算法，每一个类封装一种具体的算法，在这里，每一个封装算法的类我们都可以称之为一种策略(Strategy)。将算法的定义与使用分开，也就是将算法的行为和环境分开。<br>其中，Context（环境类）维持一个对策略类的引用实例，而Strategy（抽象策略类）声明具体的算法。</p>
<h1 id="3-模板方法模式-Template-Method-Pattern"><a href="#3-模板方法模式-Template-Method-Pattern" class="headerlink" title="3 模板方法模式 Template Method Pattern"></a>3 模板方法模式 Template Method Pattern</h1><p>定义：定义一个操作中算法的框架，而将一些步骤延迟到子类中。模板方法模 式使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。<br>其中抽象方法(Abstract    Method)实现通用不变的代码逻辑，具体方法(Concrete    Method)实现特殊变化的逻辑，钩子方法(Hook    Method)可以与一些具体步骤“挂钩”，以实现在 不同条件下执行模板方法中的不同步骤，这类钩子方法的返回类型通常是bool类型的，这类方法名一般为IsXXX()，用于对某个条件进行判断，如果条件满足则执行某一步骤，否则将不执行。</p>
<h1 id="3-访问者模式-Visitor-Pattern-操作复杂对象结构"><a href="#3-访问者模式-Visitor-Pattern-操作复杂对象结构" class="headerlink" title="3 访问者模式 Visitor Pattern - 操作复杂对象结构"></a>3 访问者模式 Visitor Pattern - 操作复杂对象结构</h1><p>它以不同的方式操作复杂对象结构。例如去医院处方单中的各种药品信息就是被访问的元素，而划价人员和药房工作人员就是访问者，它们针对同一个处方单做不同的行为。<br>在使用访问者模式时，被访问元素通常不是单独存在的，它们存储在一个集合中，这个集合 被称为“对象结构”，访问者通过遍历对象结构实现对其中存储的元素的逐个操作。被访问元素accept接受访问者，访问者可以visit访问被访问对象。</p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>Donate comment here</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="郭冬冬 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="郭冬冬 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/设计模式/" rel="tag"># 设计模式</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/07/21/Java/" rel="next" title="Java">
                <i class="fa fa-chevron-left"></i> Java
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/08/05/代理模式及Java实现动态代理/" rel="prev" title="代理模式及Java实现动态代理">
                代理模式及Java实现动态代理 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/avatar.jpg"
                alt="郭冬冬" />
            
              <p class="site-author-name" itemprop="name">郭冬冬</p>
              <p class="site-description motion-element" itemprop="description">技术总结和生活感想</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">26</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">24</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/gordon0518" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:guodongdong0518@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="gordon0518.github.io" target="_blank" title="Hexo">
                      
                        <i class="fa fa-fw fa-globe"></i>Hexo</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://www.jianshu.com/u/0a500b9f1fe1" target="_blank" title="简书">
                      
                        <i class="fa fa-fw fa-globe"></i>简书</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#面向对象设计原则"><span class="nav-number">1.</span> <span class="nav-text">面向对象设计原则</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-单例模式-Singleton-Pattern"><span class="nav-number">2.</span> <span class="nav-text">1 单例模式 Singleton Pattern *</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-简单工厂模式-Simple-Factory-Pattern"><span class="nav-number">3.</span> <span class="nav-text">1 简单工厂模式 Simple Factory Pattern *</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-工厂方法模式-Factory-Method-Pattern-1"><span class="nav-number">4.</span> <span class="nav-text">1 工厂方法模式 Factory Method Pattern 1*</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-抽象工厂模式-Abstract-Factory-Pattern"><span class="nav-number">5.</span> <span class="nav-text">1 抽象工厂模式 Abstract Factory Pattern</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-原型模式-Prototype-Pattern"><span class="nav-number">6.</span> <span class="nav-text">1 原型模式 Prototype Pattern</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-建造者模式-Builder-Pattern"><span class="nav-number">7.</span> <span class="nav-text">1 建造者模式 Builder Pattern</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-适配器模式-Adapter-Pattern-不兼容结构的协调"><span class="nav-number">8.</span> <span class="nav-text">2 适配器模式 Adapter Pattern * -    不兼容结构的协调</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-桥接模式-Bridge-Pattern"><span class="nav-number">9.</span> <span class="nav-text">2 桥接模式 Bridge Pattern</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-组合模式-Composite-Pattern"><span class="nav-number">10.</span> <span class="nav-text">2 组合模式 Composite Pattern *</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-装饰模式-Decorator-Pattern"><span class="nav-number">11.</span> <span class="nav-text">2 装饰模式 Decorator Pattern</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-外观模式-Facade-Pattern"><span class="nav-number">12.</span> <span class="nav-text">2 外观模式 Façade Pattern *</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-享元模式-Flyweight-Pattern"><span class="nav-number">13.</span> <span class="nav-text">2 享元模式 Flyweight Pattern</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-代理模式-Proxy-Pattern"><span class="nav-number">14.</span> <span class="nav-text">2 代理模式 Proxy Pattern *</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-职责链模式-Chain-of-Responsibility-Pattern"><span class="nav-number">15.</span> <span class="nav-text">3 职责链模式 Chain of Responsibility Pattern</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-命令模式-Command-Pattern"><span class="nav-number">16.</span> <span class="nav-text">3 命令模式 Command Pattern *</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-解释器模式-Interpreter-Pattern-自定义语言的实现"><span class="nav-number">17.</span> <span class="nav-text">3 解释器模式 Interpreter Pattern - 自定义语言的实现</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-迭代器模式-Iterator-Pattern-遍历聚合对象中的元素"><span class="nav-number">18.</span> <span class="nav-text">3 迭代器模式 Iterator Pattern* - 遍历聚合对象中的元素</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-中介者模式-Mediator-Pattern-协调多个对象之间的交互"><span class="nav-number">19.</span> <span class="nav-text">3 中介者模式 Mediator Pattern - 协调多个对象之间的交互</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-备忘录模式-Memento-Pattern-撤销功能的实现"><span class="nav-number">20.</span> <span class="nav-text">3 备忘录模式 Memento Pattern - 撤销功能的实现</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-观察者模式-Observer-Pattern-对象间的联动"><span class="nav-number">21.</span> <span class="nav-text">3 观察者模式 Observer Pattern * - 对象间的联动</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-状态模式-State-Pattern"><span class="nav-number">22.</span> <span class="nav-text">3 状态模式 State Pattern</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-策略模式-Strategy-Pattern"><span class="nav-number">23.</span> <span class="nav-text">3 策略模式 Strategy Pattern</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-模板方法模式-Template-Method-Pattern"><span class="nav-number">24.</span> <span class="nav-text">3 模板方法模式 Template Method Pattern</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-访问者模式-Visitor-Pattern-操作复杂对象结构"><span class="nav-number">25.</span> <span class="nav-text">3 访问者模式 Visitor Pattern - 操作复杂对象结构</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">郭冬冬</span>

  
</div>






  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user">本站访客数</i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye">本站总访问量</i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://gordon0518.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://yoursite.com/2017/07/29/设计模式/';
          this.page.identifier = '2017/07/29/设计模式/';
          this.page.title = '设计模式';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://gordon0518.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("E7BCmqy3B7tkhoIeockPTGU5-gzGzoHsz", "i20gUVUGAk8kUCt4N4hG7ghd");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
